<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>history模式实现单页面 | 板蓝根泡江小白</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/M.png">
    <meta name="description" content="Just playing around">
    
    <link rel="preload" href="/assets/css/0.styles.8527155f.css" as="style"><link rel="preload" href="/assets/js/app.67682cd3.js" as="script"><link rel="preload" href="/assets/js/2.71d48f17.js" as="script"><link rel="preload" href="/assets/js/36.05cfe6dd.js" as="script"><link rel="preload" href="/assets/js/10.029bbaa2.js" as="script"><link rel="prefetch" href="/assets/js/11.f60398ba.js"><link rel="prefetch" href="/assets/js/12.c84ea4ea.js"><link rel="prefetch" href="/assets/js/13.2770fabf.js"><link rel="prefetch" href="/assets/js/14.fbab8c7c.js"><link rel="prefetch" href="/assets/js/15.5b119f20.js"><link rel="prefetch" href="/assets/js/16.62d8cdb7.js"><link rel="prefetch" href="/assets/js/17.b4bd29f1.js"><link rel="prefetch" href="/assets/js/18.17d70f99.js"><link rel="prefetch" href="/assets/js/19.0b3b8993.js"><link rel="prefetch" href="/assets/js/20.9b968624.js"><link rel="prefetch" href="/assets/js/21.b5135f2c.js"><link rel="prefetch" href="/assets/js/22.1dbe7e61.js"><link rel="prefetch" href="/assets/js/23.4851244b.js"><link rel="prefetch" href="/assets/js/24.971776fe.js"><link rel="prefetch" href="/assets/js/25.f212a4a5.js"><link rel="prefetch" href="/assets/js/26.9b802eb8.js"><link rel="prefetch" href="/assets/js/27.ca6c746b.js"><link rel="prefetch" href="/assets/js/28.7d88f527.js"><link rel="prefetch" href="/assets/js/29.7a306f70.js"><link rel="prefetch" href="/assets/js/3.f52af491.js"><link rel="prefetch" href="/assets/js/30.1182d81d.js"><link rel="prefetch" href="/assets/js/31.d26bfd8a.js"><link rel="prefetch" href="/assets/js/32.7ac70315.js"><link rel="prefetch" href="/assets/js/33.6fc7bebe.js"><link rel="prefetch" href="/assets/js/34.87d0b230.js"><link rel="prefetch" href="/assets/js/35.b48c2186.js"><link rel="prefetch" href="/assets/js/37.8fa97eb9.js"><link rel="prefetch" href="/assets/js/38.18e043c3.js"><link rel="prefetch" href="/assets/js/39.1b15fdc8.js"><link rel="prefetch" href="/assets/js/4.99300384.js"><link rel="prefetch" href="/assets/js/40.d7f31781.js"><link rel="prefetch" href="/assets/js/41.26ce51a2.js"><link rel="prefetch" href="/assets/js/5.fadb0507.js"><link rel="prefetch" href="/assets/js/6.f09afd0f.js"><link rel="prefetch" href="/assets/js/7.ee68601e.js"><link rel="prefetch" href="/assets/js/8.af56936d.js"><link rel="prefetch" href="/assets/js/9.d5fb4788.js">
    <link rel="stylesheet" href="/assets/css/0.styles.8527155f.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">板蓝根泡江小白</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <ul class="sidebar-links"><li><a href="/" aria-current="page" class="sidebar-link">首页</a></li><li><a href="/js/sign.html" class="sidebar-link">签名</a></li><li><a href="/js/module.html" class="sidebar-link">js模块</a></li><li><a href="/pdf/http.html" class="sidebar-link">图解http</a></li><li><a href="/uidocs/docs.html" class="sidebar-link">uidocs</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>数据结构与算法</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>构建</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>issue</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>css</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>nodejs</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>vue</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/vue/history_hash.html" aria-current="page" class="active sidebar-link">history模式实现单页面</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/vue/store.html" class="sidebar-link">vue简单store的理解</a></li><li><a href="/vue/father_children.html" class="sidebar-link">vue组件见通信的方法以及父组件监听子组件生命周期</a></li><li><a href="/vue/$parent.html" class="sidebar-link">vue中$parent的一些怪事</a></li><li><a href="/vue/$ref.html" class="sidebar-link">vue异步更新</a></li><li><a href="/vue/eventbus.html" class="sidebar-link">简易eventbus</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>three.js</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>js设计模式</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>大屏自适应and拖拽插件</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h3 id="history模式实现单页面"><a href="#history模式实现单页面" class="header-anchor">#</a> history模式实现单页面</h3> <div class="language- extra-class"><pre><code>利用history.pushState可以改变网址(存在跨域限制)而不刷新页面
</code></pre></div><h4 id="注意-仅改变网址-网页不会真的跳转-也不会获取到新的内容-本质上网页还停留在原页面"><a href="#注意-仅改变网址-网页不会真的跳转-也不会获取到新的内容-本质上网页还停留在原页面" class="header-anchor">#</a> 注意:仅改变网址,网页不会真的跳转,也不会获取到新的内容,本质上网页还停留在原页面!</h4> <div class="language- extra-class"><pre><code>再监听DOMContentLoaded刷新事件与popstate前进后退以及跳转事件，防止请求服务器找不到资源
</code></pre></div><div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onclick</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>h.hisMode(<span class="token punctuation">'</span>pageone<span class="token punctuation">'</span>)<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>history1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onclick</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>h.hisMode(<span class="token punctuation">'</span>pagetwo<span class="token punctuation">'</span>)<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>history2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">onclick</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>h.hisMode(<span class="token punctuation">'</span>pagethree<span class="token punctuation">'</span>)<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>history3<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>app<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
        <span class="token keyword">function</span> <span class="token function">historyPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>

        <span class="token punctuation">}</span>
        <span class="token comment">// 渲染函数</span>
        historyPath<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">render</span><span class="token operator">=</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">path</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">const</span> routes<span class="token operator">=</span><span class="token punctuation">{</span>
                pageone<span class="token operator">:</span><span class="token string">'&lt;h1&gt;我是pageone&lt;/h1&gt;'</span><span class="token punctuation">,</span>
                pagetwo<span class="token operator">:</span><span class="token string">'&lt;h1&gt;我是pagetwo&lt;/h1&gt;'</span><span class="token punctuation">,</span>
                pagethree<span class="token operator">:</span><span class="token string">'&lt;h1&gt;我是pagethree&lt;/h1&gt;'</span><span class="token punctuation">,</span>
                notfound<span class="token operator">:</span><span class="token string">'&lt;h1&gt;404&lt;/h1&gt;'</span><span class="token punctuation">,</span>
                <span class="token string">'history_hash.html'</span><span class="token operator">:</span><span class="token string">'&lt;h1&gt;我是首页&lt;/h1&gt;'</span>
            <span class="token punctuation">}</span>
            document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'app'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerHTML<span class="token operator">=</span>routes<span class="token punctuation">[</span>path<span class="token punctuation">]</span>
        <span class="token punctuation">}</span>
        historyPath<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">hisMode</span><span class="token operator">=</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">path</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token comment">// 箭头函数确保this指向historyPath实例</span>
            <span class="token comment">// history模式pushState改变地址栏地址不进行请求</span>
            <span class="token keyword">const</span> methods<span class="token operator">=</span><span class="token punctuation">{</span>
                <span class="token function-variable function">pageone</span><span class="token operator">:</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
                    history<span class="token punctuation">.</span><span class="token function">pushState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>path<span class="token operator">:</span><span class="token string">'pageone'</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string">''</span><span class="token punctuation">,</span>path<span class="token punctuation">)</span>
                    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">'pageone'</span><span class="token punctuation">)</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token function-variable function">pagetwo</span><span class="token operator">:</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
                    history<span class="token punctuation">.</span><span class="token function">pushState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>path<span class="token operator">:</span><span class="token string">'pagetwo'</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string">''</span><span class="token punctuation">,</span>path<span class="token punctuation">)</span>
                    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">'pagetwo'</span><span class="token punctuation">)</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token function-variable function">pagethree</span><span class="token operator">:</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
                    history<span class="token punctuation">.</span><span class="token function">pushState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>path<span class="token operator">:</span><span class="token string">'pagethree'</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token string">''</span><span class="token punctuation">,</span>path<span class="token punctuation">)</span>
                    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">'pagethree'</span><span class="token punctuation">)</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            methods<span class="token punctuation">[</span>path<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        historyPath<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">init</span><span class="token operator">=</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token comment">// 渲染首页</span>
            window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'load'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>location<span class="token punctuation">.</span>pathname<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token comment">// 防止刷新</span>
            <span class="token comment">// 有后端的话后端处理url，响应回来一个render函数的地址参数</span>
            <span class="token comment">// 有后端的话监听DOMContentLoaded</span>
            window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'beforeunload'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
                <span class="token comment">// 去掉/以匹配routes中的属性</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>location<span class="token punctuation">.</span>pathname<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                event<span class="token punctuation">.</span>returnValue <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token comment">// 监听前进后退以及history.go等事件</span>
            window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'popstate'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
                <span class="token comment">// 监听在hisMode函数中放入的state对象</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>state<span class="token operator">&amp;&amp;</span>event<span class="token punctuation">.</span>state<span class="token punctuation">.</span>path<span class="token punctuation">)</span><span class="token punctuation">{</span>
                    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>state<span class="token punctuation">.</span>path<span class="token punctuation">)</span>
                <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
                    <span class="token comment">// 否则渲染404</span>
                    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">'notfound'</span><span class="token punctuation">)</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">var</span> h<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">historyPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        h<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p><div data-v-69131faf><p id="/vue/history_hash.html" data-flag-title="Your Article Title" class="leancloud_visitors" data-v-69131faf><em class="post-meta-item-text" data-v-69131faf>阅读量 </em> <i class="leancloud-visitors-count" data-v-69131faf></i></p> <br data-v-69131faf> <div id="vcomments" data-v-69131faf></div></div></p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/nodejs/excel.html" class="prev">
        excel文件处理相关模块
      </a></span> <span class="next"><a href="/vue/store.html">
        vue简单store的理解
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.67682cd3.js" defer></script><script src="/assets/js/2.71d48f17.js" defer></script><script src="/assets/js/36.05cfe6dd.js" defer></script><script src="/assets/js/10.029bbaa2.js" defer></script>
  </body>
</html>
